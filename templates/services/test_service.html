{% extends "base.html" %}
{% load staticfiles %}
{% block title %}Test service {{ service.name }}{% endblock title %}
{% block content %}
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            {% for component in components %}
                testComponent('{{ component }}');
            {% endfor %}
        }, false);

        function testComponent(component_name) {
            var html_element = document.getElementById("test_" + component_name);
            getJSON('{% url "test_service_component" service.id %}?component=' + component_name).then(
                function(xhr) { // Success (status = 200)
                    if (xhr.response.status === 'OK') {
                        html_element.innerHTML = '<i class="fa fa-check" style="color:green;" aria-hidden="true"> ' + xhr.status + '</i><br><pre class="json_output">' + JSON.stringify(xhr.response.response, null, 4) + '</pre>';
                    } else if (xhr.response.status === 'WR'){  // Warning (there are warnings)
                        html_element.innerHTML = '<i class="fa fa-check" style="color:orange;" aria-hidden="true"> ' + xhr.status + '</i><br><pre class="json_output">' + JSON.stringify(xhr.response.response, null, 4) + '</pre>Warnings:<pre class="json_output">' + JSON.stringify(xhr.response.warnings, null, 4) + '</pre>';
                    } else if (xhr.response.status === 'FA'){
                        html_element.innerHTML = '<i class="fa fa-times" style="color:red;" aria-hidden="true"> ' + xhr.status + '</i><br><pre class="json_output">' + JSON.stringify(xhr.response, null, 4) + '</pre>';
                    } else {
                        html_element.innerHTML = xhr.response.message;
                    }
                },
                function(xhr) { // Error
                    html_element.innerHTML = xhr.status + ' ' + xhr.statusText;
                }
            );
        }
    </script>

    <h1>Test service</h1>
    <h2>{{ service.name }}</h2>

    {% for component in components %}
        <h3>{{ component }}</h3>
        <div class="test_box" id="test_{{ component }}">
            <img class="spinner" src="{% static "img/logo-icon.svg" %}" alt="">
        </div>
    {% endfor %}

    <br><a href="{% url 'home' %}">Home</a>
{% endblock %}
